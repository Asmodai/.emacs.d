# Makefile for the GNU Emacs Lisp Reference Manual.
#
# 2 September 2001

# Standard configure variables.
prefix = @prefix@
infodir = @infodir@
srcdir = @srcdir@

# Redefine `TEX' if `tex' does not invoke plain TeX.  For example:
# TEX=platex
TEX=tex
MAKE=make
SHELL=/bin/sh
INSTALL_INFO = install-info
MAKEINFO=makeinfo

# Where the TeX macros are kept:
texmacrodir = /usr/local/lib/tex/macros

# The environment variable and its value to add $(srcdir) to the path
# searched for TeX input files.
texinputdir = TEXINPUTS=$(srcdir):

# The name of the manual:
VERSION=2.7
manual = elisp-manual-21-$(VERSION)

# Uncomment this line for permuted index.
# permuted_index = 1 

# List of all the texinfo files in the manual:

srcs = \
  $(srcdir)/abbrevs.texi \
  $(srcdir)/advice.texi \
  $(srcdir)/anti.texi \
  $(srcdir)/back.texi \
  $(srcdir)/backups.texi \
  $(srcdir)/buffers.texi \
  $(srcdir)/calendar.texi \
  $(srcdir)/commands.texi \
  $(srcdir)/compile.texi \
  $(srcdir)/control.texi \
  $(srcdir)/customize.texi \
  $(srcdir)/debugging.texi \
  $(srcdir)/display.texi \
  $(srcdir)/edebug.texi \
  $(srcdir)/elisp.texi \
  $(srcdir)/errors.texi \
  $(srcdir)/eval.texi \
  $(srcdir)/files.texi \
  $(srcdir)/frames.texi \
  $(srcdir)/functions.texi \
  $(srcdir)/hash.texi \
  $(srcdir)/help.texi \
  $(srcdir)/hooks.texi \
  $(srcdir)/internals.texi \
  $(srcdir)/intro.texi \
  $(srcdir)/keymaps.texi \
  $(srcdir)/lists.texi \
  $(srcdir)/loading.texi \
  $(srcdir)/locals.texi \
  $(srcdir)/macros.texi \
  $(srcdir)/maps.texi \
  $(srcdir)/markers.texi \
  $(srcdir)/minibuf.texi \
  $(srcdir)/modes.texi \
  $(srcdir)/nonascii.texi \
  $(srcdir)/numbers.texi \
  $(srcdir)/objects.texi \
  $(srcdir)/os.texi \
  $(srcdir)/positions.texi \
  $(srcdir)/processes.texi \
  $(srcdir)/searching.texi \
  $(srcdir)/sequences.texi \
  $(srcdir)/streams.texi \
  $(srcdir)/strings.texi \
  $(srcdir)/symbols.texi \
  $(srcdir)/syntax.texi \
  $(srcdir)/text.texi \
  $(srcdir)/tips.texi \
  $(srcdir)/variables.texi \
  $(srcdir)/windows.texi \
  $(srcdir)/index.unperm \
  $(srcdir)/index.perm \
  $(srcdir)/gpl.texi \
  $(srcdir)/doclicense.texi


.PHONY: clean

# The info file is named `elisp'.

elisp: $(srcs) index.texi
	rm -f elisp-*
	$(MAKEINFO) -I $(srcdir) $(srcdir)/elisp.texi

elisp.dvi: $(srcs) index.texi
	# Avoid losing old contents of aux file entirely.
	-mv elisp.aux elisp.oaux
	# First shot to define xrefs.
	$(texinputdir) $(TEX) $(srcdir)/elisp.texi
	if [ a${permuted_index} != a ]; \
	then \
	  $(srcdir)/permute-index; \
	  mv permuted.fns elisp.fns; \
	  texindex elisp.tp; \
	else \
	  texindex elisp.??; \
	fi
	$(texinputdir) $(TEX) $(srcdir)/elisp.texi

index.texi:
	if [ a${permuted_index} != a ]; \
	then \
	  ln -s $(srcdir)/index.perm index.texi || ln $(srcdir)/index.perm index.texi; \
	else \
	  ln -s $(srcdir)/index.unperm index.texi || ln $(srcdir)/index.unperm index.texi; \
	fi

install: elisp
	$(srcdir)/mkinstalldirs $(infodir)
	cp elisp elisp-* $(infodir)
	${INSTALL_INFO} --info-dir=${infodir} ${infodir}/elisp

installall: install
	install -c $(srcdir)/../man/texinfo.tex $(texmacrodir)

clean:
	rm -f *.toc *.aux *.log *.cp *.cps *.fn *.fns *.tp *.tps \
              *.vr *.vrs *.pg *.pgs *.ky *.kys
	rm -f make.out core 
	rm -f index.texi

maintainer-clean: clean
	rm -f elisp elisp-* elisp.dvi elisp.oaux

dist: elisp elisp.dvi
	-rm -rf temp
	-mkdir temp
	-mkdir temp/$(manual)
	-ln $(srcdir)/README $(srcdir)/configure.in $(srcdir)/configure \
 $(srcdir)/Makefile.in $(srcdir)/permute-index $(srcs) \
 $(srcdir)/../man/texinfo.tex \
 elisp.dvi elisp.aux elisp.??s elisp elisp-[0-9] elisp-[0-9][0-9] \
 temp/$(manual)
	-(cd temp/$(manual); rm -f mkinstalldirs)
	cp $(srcdir)/mkinstalldirs temp/$(manual)
	(cd temp/$(manual); rm -f *~)
	(cd temp; tar chf - $(manual)) | gzip > $(manual).tar.gz
	-rm -rf temp
